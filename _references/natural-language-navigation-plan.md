# 自然言語によるナビゲーション指示の理解向上計画

## 1. 概要

AIが「まっすぐ進む」「端まで進む」といった、より自然な表現のナビゲーション指示を理解し、実行できるようにシステムプロンプトを改修します。

<br />

## 2. 現状と課題

現在のシステムプロンプトでは、AIが具体的な移動回数（例: 「4マス進む」）を解釈しないようにする方向で調整されています。しかし、「まっすぐ進む」や「端まで進む」といった、目的地が明確に数値で指定されない指示に対する解釈が不足している可能性があります。

<br />

## 3. 目標

-   AIが「まっすぐ進む」という指示を、障害物やマップの端に到達するまで現在の方向へ移動することと解釈できるようにする。
-   AIが「端まで進む」という指示を、指定された方向のマップの境界に到達するまで移動することと解釈できるようにする。
-   これらの指示が、AIにとって有効な移動命令として認識されるようにする。

<br />

## 4. 実装方針 (`ai-system-prompt.js` の改修)

`ai-system-prompt.js` を以下の点に沿って修正します。

### 4.1. 「指示の解釈方法」セクションの強化

既存の「指示の解釈方法」セクション（`generateLimitedInformationSection` 関数が生成）を拡張し、以下の定義と例を追加します。

-   **「まっすぐ進む」の定義**: 現在の方向に対して、障害物（`object` タイプ）またはマップの境界（端）に到達するまで移動を継続すること。
-   **「端まで進む」の定義**: 指定された方向のマップの境界に到達するまで移動を継続すること。
-   **「次の角まで」の定義**: 現在の方向から90度曲がり、壁（通行不可能なセル）にぶつかる手前まで直進すること。

**追加する内容の例:**

```markdown
-   **「まっすぐ進む」**: 現在の方向に対して、障害物（`object` タイプ）またはマップの境界（端）に到達するまで移動を継続してください。
-   **「端まで進む」**: 指定された方向のマップの境界に到達するまで移動を継続してください。
-   **「次の角まで」**: 現在の位置から90度向きを変え、壁（通行不可能なセル）にぶつかる手前まで直進する経路を生成します。
```

### 4.2. 「指示解釈の重要な原則」セクションの更新

AIがこれらの指示を優先的に解釈するよう、原則を更新します。

**追加する内容の例:**

```markdown
5.  「まっすぐ進む」「端まで進む」「次の角まで」といった指示は、有効な移動命令として優先的に解釈してください。
```

### 4.3. 具体的な例の追加

「最終的な出力形式」セクション（`generateOutputFormatSection` 関数が生成）に、これらの指示に対する正しい出力例を追加します。

**追加する内容の例:**

```markdown
### 正しい出力例（自然言語指示の解釈）
-   指示: 「まっすぐ下に進んで、オブジェクトまで」
    出力: `DDDD` (オブジェクトまでの移動)
-   指示: 「右に端まで進む」
    出力: `RRRRR` (マップの右端までの移動)
```

### 4.4. 関連する既存セクションの調整

-   `generateNumericalUnderstandingSection` は、数値指示を移動回数として解釈しないという方針と矛盾するため、この計画の範囲外で削除または修正が必要です（これは前回の分析で指摘された最優先課題です）。
-   `generateStepByStepSection` も、数値指示の例を含まないように調整が必要です。

<br />

## 5. 実装ステップ

1.  `ai-system-prompt.js` を開く。
2.  `generateLimitedInformationSection` 関数を修正し、新しい定義と例を追加する。
3.  `generateInterpretationPrinciplesSection` 関数を修正し、新しい原則を追加する。
4.  `generateOutputFormatSection` 関数を修正し、自然言語指示の出力例を追加する。
5.  変更が意図通りに機能するか、ゲームをプレイしてテストする。

<br />

## 6. 期待される効果

-   ユーザーがより直感的で自然な言葉でAIに指示を出せるようになる。
-   ゲームの操作性が向上し、ユーザー体験が豊かになる。
-   AIがより複雑な状況判断を伴う指示を解釈できるようになるための基盤を築く。
