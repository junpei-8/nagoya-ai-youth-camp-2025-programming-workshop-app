# AI の移動理解に関する分析と改善

<br />

## 問題の特定

ユーザーから「方向がわかってない」「4マスとか、そういった実数値を理解していない」という指摘がありました。

### 具体的な問題点

1. **座標系の理解不足**
   - AI が「下」「右」などの方向と実際の座標変化の関係を理解していない可能性
   - グリッドベースの移動における座標の概念が不明確

2. **数値指示の解釈エラー**
   - 「4マス進む」を4回の移動として解釈できていない
   - 数値を移動回数に変換する処理が不明確

3. **出力形式の問題**
   - 移動コマンドの連続（"dddd"など）として出力する必要があるが、それが理解されていない可能性

<br />

## 実施した改善

### 1. 座標系と方向の明確化

```javascript
// 座標系と方向の理解
`マップは左上が原点(0,0)の座標系です：
- X軸：左から右へ（0 → 増加）
- Y軸：上から下へ（0 → 増加）
- 上（UP）：Y座標を減らす（現在位置から上の行へ）
- 下（DOWN）：Y座標を増やす（現在位置から下の行へ）
- 左（LEFT）：X座標を減らす（現在位置から左の列へ）
- 右（RIGHT）：X座標を増やす（現在位置から右の列へ）`
```

### 2. 数値理解の具体的な説明

```javascript
// 数値の理解と移動の実行
`「Nマス進む」という指示を受けた場合：
- 「4マス進む」→ その方向に4回移動（例：下なら"dddd"）
- 「1マス進む」→ その方向に1回移動（例：右なら"r"）

具体例：
- 「下に4マス」→ "dddd"
- 「右に1マス」→ "r"
- 「右に4マス」→ "rrrr"`
```

### 3. 出力形式の明示

```javascript
// 最終的な出力形式
`応答は移動文字列のみとしてください。

正しい出力例：
- "ddddrdrrrrr" （下4回、右1回、下1回、右5回）

間違った出力例：
- "下に4マス移動してから..." （説明を含む）
- "d4r1d1r5" （数字を含む）`
```

### 4. マップレイアウトの改善

座標を明示的に表示するように変更：
```javascript
`Y=0（1行目）: [s,n,n,n,n,n]
Y=1（2行目）: [n,n,t,n,n,n]
...`
```

<br />

## 期待される効果

1. **方向理解の改善**
   - 座標系の明確な説明により、方向と座標変化の関係を正確に理解
   - 各方向への移動が座標にどう影響するかを明示

2. **数値処理の正確化**
   - 「Nマス」を N 回の移動として確実に解釈
   - 具体例により、数値から移動コマンドへの変換を学習

3. **出力の標準化**
   - 移動文字の連続のみを出力することを明確化
   - 間違った出力形式の例を示すことで、避けるべきパターンを学習

<br />

## テスト推奨事項

改善後のシステムプロンプトをテストする際は、以下の点を確認してください：

1. **基本的な移動**
   - 「下に4マス」→ "dddd" が出力されるか
   - 「右に1マス」→ "r" が出力されるか

2. **複合的な指示**
   - 番号付きの段階的指示を正しく解釈できるか
   - 各ステップの数値を正確に移動回数に変換できるか

3. **出力形式**
   - 余計な説明や数字を含まない純粋な移動文字列か
   - 指定された移動キー（l, r, u, d）のみを使用しているか